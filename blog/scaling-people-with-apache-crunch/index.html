<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Scaling People with Apache Crunch | 
    Engineering Health
  
</title><meta name="description" content="a blog by engineers, for engineers"><meta name="author" content="Micah Whitacre">

<link rel="icon" href="/favicon.png">


    
        
            <link rel="stylesheet" href="/dist/main.2b1315bd4c5d4f5eb804.min.css">
        
    




<link rel="canonical" href="https://engineering.cerner.com/blog/scaling-people-with-apache-crunch/"><script src="/js/jquery-3.5.1.min.js"></script><meta property="og:title" content="Scaling People with Apache Crunch" />
<meta property="og:description" content="Starting the Big Data Journey When a company first starts to play with Big Data it typically involves a small team of engineers trying to solve a specific problem. The team decides to experiment with scalable technologies either due to outside guidance or research which makes it applicable to their problem. The team begins with the basics of Big Data spending time learning and prototyping. They learn about HDFS, flirt with HBase or other NoSQL, write the required WordCount example, and start to figure out how the technologies can fit their needs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://engineering.cerner.com/blog/scaling-people-with-apache-crunch/" /><meta property="og:image" content="https://engineering.cerner.com/images/alan-grace.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2014-05-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2014-05-09T00:00:00+00:00" /><meta property="og:site_name" content="Cerner Engineering" />

<meta itemprop="name" content="Scaling People with Apache Crunch">
<meta itemprop="description" content="Starting the Big Data Journey When a company first starts to play with Big Data it typically involves a small team of engineers trying to solve a specific problem. The team decides to experiment with scalable technologies either due to outside guidance or research which makes it applicable to their problem. The team begins with the basics of Big Data spending time learning and prototyping. They learn about HDFS, flirt with HBase or other NoSQL, write the required WordCount example, and start to figure out how the technologies can fit their needs."><meta itemprop="datePublished" content="2014-05-09T00:00:00+00:00" />
<meta itemprop="dateModified" content="2014-05-09T00:00:00+00:00" />
<meta itemprop="wordCount" content="1889"><meta itemprop="image" content="https://engineering.cerner.com/images/alan-grace.png"/>
<meta itemprop="keywords" content="design,engineering,bigdata," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://engineering.cerner.com/images/alan-grace.png"/>

<meta name="twitter:title" content="Scaling People with Apache Crunch"/>
<meta name="twitter:description" content="Starting the Big Data Journey When a company first starts to play with Big Data it typically involves a small team of engineers trying to solve a specific problem. The team decides to experiment with scalable technologies either due to outside guidance or research which makes it applicable to their problem. The team begins with the basics of Big Data spending time learning and prototyping. They learn about HDFS, flirt with HBase or other NoSQL, write the required WordCount example, and start to figure out how the technologies can fit their needs."/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand" href="/"><img src="/logo.png" style='width: 100px;' /></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="main-menu" class="collapse navbar-collapse" >
            <ul class="nav navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/culture/">Culture</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/open-source/">Open Source</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tech-talks/">Tech Talks</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/careers/">Careers</a></li>
                
            
            </ul>
            
            <div class="form-inline my-2 my-lg-0 searchbox">
    <input id="search-by" type="search" class="form-control mr-sm-2" placeholder="Search" aria-label="Search">
</div>

<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/auto-complete.min.js"></script>
<script type="text/javascript">
    var baseurl =  "https:\/\/engineering.cerner.com";
</script>
<script type="text/javascript" src="/js/search.js"></script>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article class="article-content">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">May 9, 2014</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>1889 words</span>
                            <span><i class="fas fa-clock mr-2"></i>9 mins read</span>
                        </div>

                        <h1>Scaling People with Apache Crunch</h1>

                        <ul class="authors list-inline">
        By: &nbsp;<li class="list-inline-item mr-3">
                    <div class="media author">
                            ðŸ‘¤&nbsp;<div class="media-body">
                            <h5 class="name my-0 "><a href="/authors/micah-whitacre/" class="small">Micah Whitacre</a>
                            </h5>
                        </div>
                    </div>
                </li></ul>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            <h2 id="starting-the-big-data-journey">Starting the Big Data Journey</h2>
<p>When a company first starts to play with Big Data it typically involves a small team of engineers trying to solve a specific problem.  The team decides to experiment with scalable technologies either due to outside guidance or research which makes it applicable to their problem.  The team begins with the basics of Big Data spending time learning and prototyping.  They learn about <a href="http://hadoop.apache.org/">HDFS</a>, flirt with <a href="http://hbase.apache.org/">HBase</a> or other NoSQL, write the required WordCount example, and start to figure out how the technologies can fit their needs.  The group&rsquo;s immersion into Big Data deepens as they start to move beyond a prototype into a real product.</p>
<div align="center">
    <figure class="figure">
        <a href="team_bigdata.png" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
            <img src="team_bigdata.png"
                alt="Team using Big Data"class="figure-img img-fluid"
            /> 
        </a>
    </figure>
</div>
<p>The company sees the success of using Big Data technologies and the possibilities to solve difficult problems, tackle new endeavors, and open new doors.  The company has now shifted its scalability problem out from the technical architecture into a people problem.  The small team of experts cannot satisfy the demand and transferring their accumulated knowledge to new teams is a significant investment.  Both new and experienced engineers face a steep learning curve to get up to speed.  Learning the API is not difficult but challenges typically oocur when applying the WordCount example to complex problems.   Making the mental jump from processing homogeneous data which produce a single output to a complex processing pipeline involving heterogeneous inputs, joins, and multiple outputs is difficult for even a skilled engineer.</p>
<p>Cerner has developed a number of Big Data solutions each demonstrating the 3 V&rsquo;s of data (variety, velocity, and volume).  The complexity of the problems being solved, evolving functionality, and required integration across teams led Cerner to look beyond simple MapReduce.  Cerner began to focus on how to construct a processing infrastructure that naturally aligned with the way the processing is described.  Looking through the options available for processing pipelines including <a href="http://hive.apache.org/">Hive</a>, <a href="http://pig.apache.org/">Pig</a>, and <a href="http://www.cascading.org/">Cascading</a>, Cerner finally arrived at using <a href="http://crunch.apache.org/">Apache Crunch</a>.  Using Crunch&rsquo;s concepts, we found that we were easily able to translate how we described a problem into concepts we can code.  Additionally the API was well suited for our complicated data models and building integration contracts between teams.</p>
<p>When we describe a problem we often talk about its flow through the various processing steps.  The processing flow is comprised of data from multiple sources, several transformations, various joins, and finally the persistence of the data.  Looking at an example problem of transforming raw data into a normalized object for downstream consumers we might encounter a problem similar to the diagram below.</p>
<div align="center">
    <figure class="figure">
        <a href="example_processing_pipeline.png" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
            <img src="example_processing_pipeline.png"
                alt="Example Processing Problem"class="figure-img img-fluid"
            /> 
        </a>
    </figure>
</div>
<p>If we apply this problem to the raw MapReduce framework we begin to see problems absent in the standard WordCount example.  The heterogeneous data and models, the custom join logic, and follow up grouping by key all could result in extra code or difficulty fitting this processing into a single MapReduce job.  When our problem expands to multiple MapReduce jobs we now have to write custom driver code or bring in another system like <a href="http://oozie.apache.org/">Oozie</a> to chain the workflow together.  Additionally while we could fit the steps neatly into 1-2 MapReduce jobs that careful orchestration and arrangement could become imbalanced as we introduce new processing needs into the workflow.</p>
<div align="center">
    <figure class="figure">
        <a href="example_processing_pipeline_new_functionality.png" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
            <img src="example_processing_pipeline_new_functionality.png"
                alt="Example Processing Problem with more functionality"class="figure-img img-fluid"
            /> 
        </a>
    </figure>
</div>
<p>This problem is common and fairly basic with respect to some of the processing needs we faced at Cerner.  For the experienced MapReduce developers this problem might cause a momentary pause to design it but that is due to your expertise.  For those less skilled imagine being able to break this problem down into the processing steps you understand and POJO like models of which you are already familiar.  Breaking this problem down using Apache Crunch we can see how we can articulate the problem and still take advantage of the processing efficiency of MapReduce.</p>
<h2 id="building-a-processing-pipeline-with-apache-crunch">Building a Processing Pipeline with Apache Crunch</h2>
<p>Apache Crunch allows developers to construct complicated processing workflows into <a href="http://crunch.apache.org/user-guide.html#mrpipeline">pipelines</a>.  Pipelines are directed acyclic graphs (DAG) comprised of input data that is then transformed through functions and groupings to produce output data.  When a developer is done constructing the pipeline Apache Crunch will calculate the appropriate processing steps and submit the steps to the execution engine.  In this example we will talk about using Apache Crunch in the context of MapReduce but it also supports running on <a href="http://spark.apache.org/">Apache Spark</a>.  It should be noted that pipelines are lazily executed.  This means that no work will be done until the pipeline is executed.</p>
<p>To begin processing we need a pipeline instance on which we will construct our DAG.  To create a MRPipeline we need the typical Hadoop <a href="https://hadoop.apache.org/docs/r2.2.0/api/org/apache/hadoop/conf/Configuration.html">Configuration</a> instance for the cluster and <a href="https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/mapreduce/Job.html#setJarByClass-java.lang.Class-">the driver class</a> for the processing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Pipeline pipeline <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MRPipeline<span style="color:#f92672">(</span>Driver<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> conf<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>With a pipeline instance available the next step is to describe the inputs to the processing using at least one Crunch <a href="http://crunch.apache.org/user-guide.html#rwdata">Source</a>.  A pipeline must contain at least one source but could read from multiple.  Apache Crunch provides implementations for the typical inputs such as Sequence Files, HFiles, Parquet, Avro, HBase, and Text.  As an example if we were to read data out of a text file we might write code like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>PType<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> ptype <span style="color:#f92672">=</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>PCollection<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> refDataStrings <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TextFileSource<span style="color:#f92672">(</span>path<span style="color:#f92672">,</span> ptype<span style="color:#f92672">));</span>
</span></span></code></pre></div><p>This code utilizes the TextFileSource to generate a collection of Java Strings from files at a certain path.  The code also introduces two additional Apache Crunch concepts of <a href="http://crunch.apache.org/user-guide.html#datamodel">PCollections</a> and <a href="http://crunch.apache.org/user-guide.html#serde">PTypes</a>.  A PCollection represents potential data elements to process.  Since a pipeline is lazily executed it is not a physical representation of all of the elements.  A PCollection cannot be created but can be read or transformed.  Apache Crunch also has special forms of PCollections, PTable and PGroupedTable, which are useful in performing join operations on the data.  A PType is a concept that hides serialization and deserialization from pipeline developers.  In this example the developer is using native Java strings instead of dealing with wrapper classes like Writable&rsquo;s Text class.</p>
<p>Processing based off of Java Strings is error prone so typically developers would transform the data into a model object that is easier to work with.  Transformation of a PCollection is done through a <a href="http://crunch.apache.org/user-guide.html#dataproc">DoFn</a>.  A DoFn processes a single element of the PCollection into zero or many alternate forms depending on its logic.  The bulk of a processing pipeline&rsquo;s logic resides in implementations of DoFn.  Custom implementations of a DoFn requires extending the DoFn class as well as defining the input and output types.  This allows Crunch to provide compile time checking as transformations are applied to collections.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConvertReferenceDataFn</span> <span style="color:#66d9ef">extends</span> DoFn<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">process</span> <span style="color:#f92672">(</span>String input<span style="color:#f92672">,</span> Emitter<span style="color:#f92672">&lt;</span>RefData<span style="color:#f92672">&gt;</span> emitter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       RefData data <span style="color:#f92672">=</span> <span style="color:#75715e">//processing logic;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       emitter<span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span>data<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PType<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> ptype <span style="color:#f92672">=</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>PCollection<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> refDataStrings <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TextFileSource<span style="color:#f92672">(</span>path<span style="color:#f92672">,</span> ptype<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>PCollection<span style="color:#f92672">&lt;</span>RefData<span style="color:#f92672">&gt;</span> refData <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  refStrings<span style="color:#f92672">.</span><span style="color:#a6e22e">parallelDo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConvertReferenceDataFn<span style="color:#f92672">(),</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">records</span><span style="color:#f92672">(</span>RefData<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
</span></span></code></pre></div><p>Recalling the previous example processing problem we see that we need to perform join and grouping operations based on a key.  Instead of converting the strings into a RefData object it would actually be better to convert the string into a key/value pair (e.g. Pair&lt;String, RefData&gt;).  Apache Crunch has a PTable&lt;K, V&gt;, which is simply a special form of PCollection&lt;Pair&lt;K, V&raquo;.  Adjusting the function we can instead produce the key/value pair.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConvertReferenceDataFn</span> <span style="color:#66d9ef">extends</span> DoFn<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">process</span> <span style="color:#f92672">(</span>String input<span style="color:#f92672">,</span> Emitter<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;&gt;</span> emitter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       RefData data <span style="color:#f92672">=</span> <span style="color:#75715e">//processing logic;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       String id <span style="color:#f92672">=</span> <span style="color:#75715e">//extract id;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       emitter<span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pair<span style="color:#f92672">(</span>id<span style="color:#f92672">,</span> data<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PType<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> ptype <span style="color:#f92672">=</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>PCollection<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> refDataStrings <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TextFileSource<span style="color:#f92672">(</span>path<span style="color:#f92672">,</span> ptype<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;</span> refData <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  refStrings<span style="color:#f92672">.</span><span style="color:#a6e22e">parallelDo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConvertReferenceDataFn<span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>    Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">tableOf</span><span style="color:#f92672">(</span>Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">(),</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">records</span><span style="color:#f92672">(</span>RefData<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)));</span>
</span></span></code></pre></div><p>Utilizing the PTable&lt;String, RefData&gt; collection we could then <a href="http://crunch.apache.org/user-guide.html#joins">join</a> that collection with another similarly keyed PTable using one of the many prebuilt implementations.  The built in join functionality helps to avoid developing custom implementations of a common data processing pattern.</p>
<p>More functions are applied to the joined data to continue the processing workflow.  The processing of the data is distributed in separate tasks across the cluster.  In the example problem we need all of the data for a <a href="http://crunch.apache.org/user-guide.html#gbk">given key to be grouped</a> to a single task for processing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> data <span style="color:#f92672">=</span> <span style="color:#f92672">...;</span>
</span></span><span style="display:flex;"><span>PGroupedTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> groupedModels <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">groupByKey</span><span style="color:#f92672">();</span>
</span></span></code></pre></div><p>A pipeline requires at least one collection of data to be persisted to a <a href="http://crunch.apache.org/user-guide.html#targets">target</a>.  Crunch provides the standard targets for data but consumer can also easily create new custom inputs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#75715e">//persist Avro models
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>models<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> AvroFileTarget<span style="color:#f92672">(</span>path<span style="color:#f92672">));</span>
</span></span></code></pre></div><p>When constructing the processing pipline for the example problem we would end up with an executable program that looks like the following:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>    Pipeline pipeline <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MRPipeline<span style="color:#f92672">(</span>Driver<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> conf<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Read data from sources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PType<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> ptype <span style="color:#f92672">=</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;</span> refDataStrings <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TextFileSource<span style="color:#f92672">(</span>path1<span style="color:#f92672">,</span> ptype<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefModel<span style="color:#f92672">&gt;</span> refModelStrings <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TextFileSource<span style="color:#f92672">(</span>path1<span style="color:#f92672">,</span> ptype<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Convert the Strings into models
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;</span> refData <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      refStrings<span style="color:#f92672">.</span><span style="color:#a6e22e">parallelDo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConvertReferenceDataFn<span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>        Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">tableOf</span><span style="color:#f92672">(</span>Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">(),</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">records</span><span style="color:#f92672">(</span>RefData<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefModel<span style="color:#f92672">&gt;</span> refModel <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      refStrings<span style="color:#f92672">.</span><span style="color:#a6e22e">parallelDo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConvertReferenceModelFn<span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>        Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">tableOf</span><span style="color:#f92672">(</span>Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">strings</span><span style="color:#f92672">(),</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">records</span><span style="color:#f92672">(</span>RefModel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Data separate input together.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Pair<span style="color:#f92672">&lt;</span>RefData<span style="color:#f92672">,</span> RefModel<span style="color:#f92672">&gt;&gt;</span> joinedDataModel <span style="color:#f92672">=</span> refModel<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">(</span>refData<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Apply a similar DoFn to convert the Pair&lt;RefData, RefModel&gt; into a single object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> models <span style="color:#f92672">=</span> <span style="color:#f92672">...;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Filter out data that is not useful
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> filteredModels <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FilterModelFn<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Group the data by key to have all model instances with the same key in a single location
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PGroupedTable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> groupedModels <span style="color:#f92672">=</span> filteredModels<span style="color:#f92672">.</span><span style="color:#a6e22e">groupByKey</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Convert the grouped Models into a single model object if they share the same key.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PCollection<span style="color:#f92672">&lt;</span>PersonModel<span style="color:#f92672">&gt;</span> personModels <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      groupedModels<span style="color:#f92672">.</span><span style="color:#a6e22e">parallelDo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConvertPersonModelFn<span style="color:#f92672">(),</span> Avros<span style="color:#f92672">.</span><span style="color:#a6e22e">records</span><span style="color:#f92672">(</span>PersonModel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Write out the Person Model objects
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>personModels<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> AvroFileTarget<span style="color:#f92672">(</span>path<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//At this point the pipeline has been constructed but nothing executed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//Therefore tell the pipeline to execute.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    PipelineResult result <span style="color:#f92672">=</span> pipeline<span style="color:#f92672">.</span><span style="color:#a6e22e">done</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConvertReferenceDataFn</span> <span style="color:#66d9ef">extends</span> DoFn<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">process</span> <span style="color:#f92672">(</span>String input<span style="color:#f92672">,</span> Emitter<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefData<span style="color:#f92672">&gt;&gt;</span> emitter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       RefData data <span style="color:#f92672">=</span> <span style="color:#75715e">//processing logic;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       String id <span style="color:#f92672">=</span> <span style="color:#75715e">//extract id;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       emitter<span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pair<span style="color:#f92672">(</span>id<span style="color:#f92672">,</span> data<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConvertReferenceModelFn</span> <span style="color:#66d9ef">extends</span> DoFn<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefModel<span style="color:#f92672">&gt;&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">process</span> <span style="color:#f92672">(</span>String input<span style="color:#f92672">,</span> Emitter<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> RefModel<span style="color:#f92672">&gt;&gt;</span> emitter<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       RefModel model <span style="color:#f92672">=</span> <span style="color:#75715e">//processing logic;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       String id <span style="color:#f92672">=</span> <span style="color:#75715e">//extract id;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       emitter<span style="color:#f92672">.</span><span style="color:#a6e22e">emit</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pair<span style="color:#f92672">(</span>id<span style="color:#f92672">,</span> model<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FilterModelFn</span> <span style="color:#66d9ef">extends</span> Filter<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">filter</span> <span style="color:#f92672">(</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Model<span style="color:#f92672">&gt;</span> model<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">boolean</span> include <span style="color:#f92672">=</span> <span style="color:#75715e">//logic to apply to the model
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">return</span> include<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConvertPersonModelFn</span> <span style="color:#66d9ef">extends</span> MapFn<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Iterable<span style="color:#f92672">&lt;</span>Model<span style="color:#f92672">&gt;&gt;&gt;{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">public</span> PersonModel <span style="color:#a6e22e">map</span> <span style="color:#f92672">(</span>Pair<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Iterable<span style="color:#f92672">&lt;</span>Model<span style="color:#f92672">&gt;&gt;</span> models<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       PersonModel model <span style="color:#f92672">=</span> <span style="color:#75715e">//apply grouping logic to generate model from many items.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">return</span> model<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is very easy to see how the processing steps and flow of the original diagram can be mapped to Apache Crunch concepts.</p>
<div align="center">
    <figure class="figure">
        <a href="example_processing_pipeline_crunch_concepts.png" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
            <img src="example_processing_pipeline_crunch_concepts.png"
                alt="Crunch Concepts Applied to Processing"class="figure-img img-fluid"
            /> 
        </a>
    </figure>
</div>
<p>Executing the code as written above would cause Apache Crunch to calculate the execution graph to be spread over two MapReduce jobs.</p>
<div align="center">
    <figure class="figure">
        <a href="pipeline_mr.png" class="d-block" data-toggle="lightbox" data-gallery="post-gallery">
            <img src="pipeline_mr.png"
                alt="Pipeline Execution"class="figure-img img-fluid"
            /> 
        </a>
    </figure>
</div>
<p>In this case having a MapReduce job being reduce only is less than ideal but the team has been able to focus on correctness and functionality first.  Focus can now be shifted on performance tuning or adjusting algorithms as appropriate.  The solid foundation of functionality and the simplicity of the concepts allows developers to easily understand how the processing pipeline.  The ease of understanding helps to allow the team to refactor and iterate with confidence.</p>
<p>This blog post is essentially my script for my <a href="http://apacheconnorthamerica2014.sched.org/event/37a39cc1b611e53ea5b6e348786337ad?iframe=no&amp;w=100&amp;sidebar=yes&amp;bg=no#.U1hyq-ZdVDw">North America ApacheCon 2014 presentation</a>.  Slides are available <a href="http://events.linuxfoundation.org/sites/events/files/slides/Simplifying%20Big%20Data%20with%20Apache%20Crunch.pdf">here</a>.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="http://crunch.apache.org/user-guide.html">Crunch User Guide</a></li>
</ul>

                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/design">
                                    <i class="fas fa-tag mr-2"></i>design
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/engineering">
                                    <i class="fas fa-tag mr-2"></i>engineering
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/bigdata">
                                    <i class="fas fa-tag mr-2"></i>bigdata
                                </a></div><ul class="share nav my-3 justify-content-end">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fscaling-people-with-apache-crunch%2f&text=Scaling%20People%20with%20Apache%20Crunch">
              <i class="fa-fw fab fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fscaling-people-with-apache-crunch%2f&title=Scaling%20People%20with%20Apache%20Crunch">
                <i class="fa-fw fab fa-linkedin-in"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fengineering.cerner.com%2fblog%2fscaling-people-with-apache-crunch%2f&t=Scaling%20People%20with%20Apache%20Crunch">
                <i class="fa-fw fab fa-facebook-f"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://reddit.com/submit?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fscaling-people-with-apache-crunch%2f&title=Scaling%20People%20with%20Apache%20Crunch">
                <i class="fa-fw fab fa-reddit-alien"></i>
            </a>
        </li>
    </nav>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div></article>
        </div>
    </div>

    <div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/thinking-in-mapreduce/" class="d-block"><img data-src="/blog/thinking-in-mapreduce/MapReduce1_hu436bc019973155fe9855a21e1b676571_45310_700x350_fill_box_smart1_3.png" class="card-img-top mx-auto d-block" alt="Thinking in MapReduce"><div class="card-body">
            <h4 class="card-title">Thinking in MapReduce</h4>
            <p class="card-text text-muted text-uppercase">July 31, 2013</p>
            <div class="card-text">
                This is the blog form of theÂ Thinking in MapReduceÂ talk at StampedeCon 2013. Iâ€™ve linked to existing resources for some items discussed in the talk, but the structure and major points are here.
We programmers have had it pretty good over the years. In almost all cases, hardware scaled up faster than data size and complexity. Unfortunately, this is changing for many of us. Mooreâ€™s Law has taken on a new direction; we gain power with parallel processing rather than faster clock cycles.
            </div>
        </div>
    </a>
  </div>
            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/near-real-time-processing-over-hadoop-and-hbase/" class="d-block"><img data-src="/blog/near-real-time-processing-over-hadoop-and-hbase/chart-search-screen_hu26ee20457c5aa986f1cc23f95c01380d_648930_700x350_fill_box_smart1_3.png" class="card-img-top mx-auto d-block" alt="Near Real-time Processing Over Hadoop and HBase"><div class="card-body">
            <h4 class="card-title">Near Real-time Processing Over Hadoop and HBase</h4>
            <p class="card-text text-muted text-uppercase">February 27, 2013</p>
            <div class="card-text">
                From MapReduce to realtime This post covers much of the Near-Realtime Processing Over HBase talk Iâ€™m giving at ApacheCon NA 2013 in blog form. It also draws from the Hadoop, HBase, and Healthcare talk from StrataConf/Hadoop World 2012.
The first significant use of Hadoop at Cerner came in building search indexes for patient charts. While creation of simple search indexes is almost commoditized, we wanted a better experience based on clinical semantics.
            </div>
        </div>
    </a>
  </div>
            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/composable-mapreduce-with-hadoop-and-crunch/" class="d-block"><img data-src="/blog/composable-mapreduce-with-hadoop-and-crunch/diagram1_hu7094931f5df834b55429a2ec082916c6_53870_700x350_fill_box_smart1_3.png" class="card-img-top mx-auto d-block" alt="Composable MapReduce with Hadoop and Crunch"><div class="card-body">
            <h4 class="card-title">Composable MapReduce with Hadoop and Crunch</h4>
            <p class="card-text text-muted text-uppercase">February 3, 2013</p>
            <div class="card-text">
                Most developers know this pattern well: we design a set of schemas to represent our data, and then work with that data via a query language. This works great in most cases, but becomes a challenge as data sets grow to an arbitrary size and complexity. Data sets can become too large to query and update with conventional means.
These challenges often arise with Hadoop, simply because Hadoop is a popular tool to tackle such data sets.
            </div>
        </div>
    </a>
  </div>
            </div></div>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://engineering.cerner.com/index.xml" rel="alternate" type="application/rss+xml" class="icons d-block">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a></li><li class="list-inline-item">
                            <a href="https://github.com/cerner" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.instagram.com/cernercorporation/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/cerner-corporation" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fengineering.cerner.com%2F&amp;screen_name=CernerEng" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.youtube.com/user/cernereng?sub_confirmation=1" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                </ul>

                <p class="text-light">
                    
                        Copyright &copy; 2022
                    
                </p>

                <p class="text-light">
                Made with â¤ï¸ by Cerner engineers.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.0f92af9103b4f0550a4b.min.js"></script>
        
    






    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-37701128-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>
</html>
