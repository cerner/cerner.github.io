<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Identifying Network ACL Issues with Chef Locally | 
    Engineering Health
  
</title><meta name="description" content="a blog by engineers, for engineers"><meta name="author" content="Aaron Blythe, David Crowder">

<link rel="icon" href="/favicon.png">


    
        
            <link rel="stylesheet" href="/dist/main.2b1315bd4c5d4f5eb804.min.css">
        
    




<link rel="canonical" href="https://engineering.cerner.com/blog/identifying-network-acl-issues-with-chef-locally/"><script src="/js/jquery-3.5.1.min.js"></script><meta property="og:title" content="Identifying Network ACL Issues with Chef Locally" />
<meta property="og:description" content="At Cerner, we use Chef to automate our deployments across a very large distributed system comprised of many thousands of nodes. While we employ ServerSpec and Test Kitchen extensively to test our Chef recipes, this still doesn&rsquo;t identify all possible failure scenarios. In a large distributed system such as ours, we occasionally run into connectivity failures between machines due to network ACL issues. This could be due to a variety of reasons." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://engineering.cerner.com/blog/identifying-network-acl-issues-with-chef-locally/" /><meta property="og:image" content="https://engineering.cerner.com/images/alan-grace.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-11-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-11-17T00:00:00+00:00" /><meta property="og:site_name" content="Cerner Engineering" />

<meta itemprop="name" content="Identifying Network ACL Issues with Chef Locally">
<meta itemprop="description" content="At Cerner, we use Chef to automate our deployments across a very large distributed system comprised of many thousands of nodes. While we employ ServerSpec and Test Kitchen extensively to test our Chef recipes, this still doesn&rsquo;t identify all possible failure scenarios. In a large distributed system such as ours, we occasionally run into connectivity failures between machines due to network ACL issues. This could be due to a variety of reasons."><meta itemprop="datePublished" content="2015-11-17T00:00:00+00:00" />
<meta itemprop="dateModified" content="2015-11-17T00:00:00+00:00" />
<meta itemprop="wordCount" content="371"><meta itemprop="image" content="https://engineering.cerner.com/images/alan-grace.png"/>
<meta itemprop="keywords" content="engineering," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://engineering.cerner.com/images/alan-grace.png"/>

<meta name="twitter:title" content="Identifying Network ACL Issues with Chef Locally"/>
<meta name="twitter:description" content="At Cerner, we use Chef to automate our deployments across a very large distributed system comprised of many thousands of nodes. While we employ ServerSpec and Test Kitchen extensively to test our Chef recipes, this still doesn&rsquo;t identify all possible failure scenarios. In a large distributed system such as ours, we occasionally run into connectivity failures between machines due to network ACL issues. This could be due to a variety of reasons."/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand" href="/"><img src="/logo.png" style='width: 100px;' /></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="main-menu" class="collapse navbar-collapse" >
            <ul class="nav navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/culture/">Culture</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/open-source/">Open Source</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/tech-talks/">Tech Talks</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/careers/">Careers</a></li>
                
            
            </ul>
            
            <div class="form-inline my-2 my-lg-0 searchbox">
    <input id="search-by" type="search" class="form-control mr-sm-2" placeholder="Search" aria-label="Search">
</div>

<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/auto-complete.min.js"></script>
<script type="text/javascript">
    var baseurl =  "https:\/\/engineering.cerner.com";
</script>
<script type="text/javascript" src="/js/search.js"></script>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article class="article-content">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">November 17, 2015</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>371 words</span>
                            <span><i class="fas fa-clock mr-2"></i>2 mins read</span>
                        </div>

                        <h1>Identifying Network ACL Issues with Chef Locally</h1>

                        <ul class="authors list-inline">
        By: &nbsp;<li class="list-inline-item mr-3">
                    <div class="media author">
                            üë§&nbsp;<div class="media-body">
                            <h5 class="name my-0 "><a href="/authors/aaron-blythe/" class="small">Aaron Blythe</a>
                            </h5>
                        </div>
                    </div>
                </li><li class="list-inline-item mr-3">
                    <div class="media author">
                            üë§&nbsp;<div class="media-body">
                            <h5 class="name my-0 "><a href="/authors/david-crowder/" class="small">David Crowder</a>
                            </h5>
                        </div>
                    </div>
                </li></ul>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            <p>At Cerner, we use <a href="https://www.chef.io/">Chef</a> to automate our deployments across a very large distributed system comprised of many thousands of nodes. While we employ <a href="http://serverspec.org/">ServerSpec</a> and <a href="http://kitchen.ci/">Test Kitchen</a> extensively to test our Chef recipes, this still doesn&rsquo;t identify all possible failure scenarios. In a large distributed system such as ours, we occasionally run into connectivity failures between machines due to network ACL issues. This could be due to a variety of reasons. The simplest being that you didn‚Äôt know what all you were connecting to. The second being that you didn‚Äôt ask for the ACLs to be opened early enough, or at all. And finally (and most frustrating), you asked and were granted an ACL change but there still exists an issue (like an unfollowed redirect). When we took a look at these issues, we saw an opportunity for improvement in our Chef testing.</p>
<p>This is why we created <a href="https://github.com/cerner/ops_tcpdump_handler">ops_tcpdump_handler</a>, an open source Chef cookbook that is helping us identify network connectivity issues during Chef test runs.</p>
<p>As explained in the project README, when you add this cookbook into a Test Kitchen or <a href="https://www.vagrantup.com/">Vagrant</a> run list, you&rsquo;ll see an output similar to below that shows connection attempts between nodes. This will not only help you understand what nodes you&rsquo;re connecting to in a Chef run, but also diagnose any connectivity issues that arise.</p>
<pre tabindex="0"><code>==&gt; node01: attempted to connect to: proxy06.fedoraproject.org using http
==&gt; node01: attempted to connect to: mirror.sfo12.us.leaseweb.net using http
==&gt; node01: attempted to connect to: li63-48.members.linode.com using https
==&gt; node01: attempted to connect to: 23.235.40.133 using https
==&gt; node01: attempted to connect to: github.com using https
==&gt; node01: attempted to connect to: codeload.github.com using https
==&gt; node01: attempted to connect to: s3-1.amazonaws.com using https
</code></pre><p>We&rsquo;re currently using this cookbook in our Chef test runs to identify and help troubleshoot connectivity issues between nodes. Next, we&rsquo;re going to incorporate this into our continuous delivery pipeline to verify connectivity first before proceeding with the deployment. We decided to open source this work to get feedback from the community and to hear your experience with these types of issues. We&rsquo;d love to hear your experience with incorporating this cookbook into your pipeline or other approaches you&rsquo;ve taken with these types of issues.</p>

                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/engineering">
                                    <i class="fas fa-tag mr-2"></i>engineering
                                </a></div><ul class="share nav my-3 justify-content-end">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fidentifying-network-acl-issues-with-chef-locally%2f&text=Identifying%20Network%20ACL%20Issues%20with%20Chef%20Locally">
              <i class="fa-fw fab fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fidentifying-network-acl-issues-with-chef-locally%2f&title=Identifying%20Network%20ACL%20Issues%20with%20Chef%20Locally">
                <i class="fa-fw fab fa-linkedin-in"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fengineering.cerner.com%2fblog%2fidentifying-network-acl-issues-with-chef-locally%2f&t=Identifying%20Network%20ACL%20Issues%20with%20Chef%20Locally">
                <i class="fa-fw fab fa-facebook-f"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://reddit.com/submit?url=https%3a%2f%2fengineering.cerner.com%2fblog%2fidentifying-network-acl-issues-with-chef-locally%2f&title=Identifying%20Network%20ACL%20Issues%20with%20Chef%20Locally">
                <i class="fa-fw fab fa-reddit-alien"></i>
            </a>
        </li>
    </nav>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div></article>
        </div>
    </div>

    <div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/javascript-logging-we-can-do-better/" class="d-block"><img data-src="/blog/javascript-logging-we-can-do-better/healthe_life_errors_hu931f198abeccd066091d328e34a5ab65_124433_700x350_fill_box_smart1_3.png" class="card-img-top mx-auto d-block" alt="JavaScript Logging: We can do better!"><div class="card-body">
            <h4 class="card-title">JavaScript Logging: We can do better!</h4>
            <p class="card-text text-muted text-uppercase">July 20, 2015</p>
            <div class="card-text">
                Currently in the world of JavaScript these options are what we most commonly use to generate logs:
 console.log console.info console.warn console.error  These are actually pretty good in most modern browsers. Even if you go back to Internet Explorer 8 console.log and friends work as long as you have the developer tools open.
Given that we have these logging utilities what is the problem with using them? When in local development these are just fine for helping debug and speed up development.
            </div>
        </div>
    </a>
  </div>
            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/managing-30000-logging-events-per-day-with-splunk/" class="d-block"><img data-src="/blog/managing-30000-logging-events-per-day-with-splunk/Log-Aggregator_hu250099d7c5651446aaf180f5da97c019_295357_700x350_fill_box_smart1_3.png" class="card-img-top mx-auto d-block" alt="Managing 30,000 Logging Events per Day with Splunk"><div class="card-body">
            <h4 class="card-title">Managing 30,000 Logging Events per Day with Splunk</h4>
            <p class="card-text text-muted text-uppercase">January 29, 2015</p>
            <div class="card-text">
                Our team works on a patient facing web application with a thousand live clients with 2,315,000&#43; users. On an average, the high traffic results into more than 40,000 visits and 300,000 page views daily generating about 30,000 logging events. A considerable portion of these events are of information and warning level in order to aid proactive monitoring or identify potential issues due to clients‚Äô misconfiguration.
Before Splunk To handle this large volume of logging, our team created a rotational support role to manually monitor the logs at regular intervals daily.
            </div>
        </div>
    </a>
  </div>
            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/blog/cerner-and-the-apache-software-foundation/" class="d-block"><img data-src="/blog/cerner-and-the-apache-software-foundation/asf-sponsorship-silver-logo_hu2eb046b3b5bed0960f6685a9ad844d22_52769_700x350_fill_q75_box_smart1.jpg" class="card-img-top mx-auto d-block" alt="Cerner and the Apache Software Foundation"><div class="card-body">
            <h4 class="card-title">Cerner and the Apache Software Foundation</h4>
            <p class="card-text text-muted text-uppercase">October 28, 2014</p>
            <div class="card-text">
                At the beginning of this year, [we announced that Cerner became a bronze-level sponsor]({%post_url 2014-01-28-sponsoring-the-apache-software-foundation%}) of the non-profit Apache Software Foundation (ASF). Many of the open source projects we use and contribute to are under the ASF umbrella, so supporting the mission and work of the ASF is important to us.
We‚Äôre happy to announce that Cerner has now increased our sponsorship of the ASF to become a silver-level sponsor. Open source continues to play an integral role in both our architecture and engineering culture.
            </div>
        </div>
    </a>
  </div>
            </div></div>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://engineering.cerner.com/index.xml" rel="alternate" type="application/rss+xml" class="icons d-block">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a></li><li class="list-inline-item">
                            <a href="https://github.com/cerner" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.instagram.com/cernercorporation/" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/cerner-corporation" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fengineering.cerner.com%2F&amp;screen_name=CernerEng" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://www.youtube.com/user/cernereng?sub_confirmation=1" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                </ul>

                <p class="text-light">
                    
                        Copyright &copy; 2022
                    
                </p>

                <p class="text-light">
                Made with ‚ù§Ô∏è by Cerner engineers.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.0f92af9103b4f0550a4b.min.js"></script>
        
    






    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-37701128-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>
</html>
